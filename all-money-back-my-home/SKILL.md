---
name: all-money-back-my-home
description: 分析投研报告（支持 PDF/图片/Word 等多种格式），提取股票信息并生成结构化投资策略表格
---

## 目标

将任意投研机构的报告进行自动化分析，完成以下任务：

1. 提取报告中提及的所有股票名称
2. 识别每只股票的所属板块（根据上下文判断）
3. 根据报告措辞判断推荐等级
4. 提取核心推荐理由
5. 根据AI知识库补充对应的股票代码
6. 生成结构化的Markdown表格输出
7. 导出 PNG 长图（必选）

## 支持格式

| 格式 | 扩展名 | 提取方式 |
|------|--------|----------|
| PDF | `.pdf` | pdftotext / PyPDF2 |
| Word | `.docx/.doc` | pandoc / python-docx |
| 图片 | `.png/.jpg/.webp` | **Agent 视觉能力直接分析，不要进行OCR操作！** |
| 纯文本 | `.txt/.md` | 直接读取 |
| HTML | `.html/.htm` | pandoc / w3m |

## 工作流

### Step 1: 内容提取（多格式支持）

**文本格式** (PDF/DOCX/TXT/HTML):

```bash
# 使用统一提取脚本
./scripts/extract_content.sh <file_path>
```

**图片格式** (PNG/JPG/WEBP):

```txt
# 直接将图片路径提供给 Agent，利用视觉能力分析
请分析 /path/to/report.png 中的股票
```

### Step 2: 股票信息识别

从文本中逐一识别：

- **股票名称**：识别中文上市公司名称
- **板块分类**：根据上下文语境判断所属行业/概念板块
- **推荐等级**：参考 `references/analysis_guidelines.md` 中的判断规则
- **推荐理由**：提取报告中对该股票的核心观点

### Step 3: 股票代码补充

根据AI知识库，为每只识别到的股票补充对应代码，如果不确定则联网查询相关信息：

- A股沪市：`600xxx.SH` / `601xxx.SH` / `603xxx.SH` / `688xxx.SH`（科创板）
- A股深市：`000xxx.SZ` / `002xxx.SZ` / `300xxx.SZ`（创业板） / `301xxx.SZ`
- 港股：`xxxx.HK`
- 美股：`TICKER`

### Step 4: 过滤与排序（根据用户需求）

默认：

- 默认按A股市场的股票过滤
- 默认按推荐等级排序，

### Step 5: 输出生成（含亮点）

如果有多份输入文件，则合并后输出。

```markdown
## 📊 [报告标题] 推荐股票清单

### 分析结果亮点
- 📈 最高推荐 ⭐⭐⭐⭐⭐：皖维高新、协创数据、聚和材料、先导智能、科大讯飞、德赛西威、江波龙、超捷股份、紫金矿业等
- 🔥 热门板块：AI应用/算力 > 存储 > 商业航天 > 人形机器人 > 固态电池
- 📅 关键催化剂：工信部固态电池送审、北美财报周、特斯拉V3发布、川普访华

| 股票名称 | 股票代码 | 板块 | 推荐等级 | 推荐理由 |
|---------|---------|------|---------|---------|
| ... | ... | ... | ... | ... |

> ⚠️ 以上信息仅为报告内容整理，不构成投资建议。
```

**分析结果亮点生成规则（可执行规范）**：

1) 最高推荐  
   - 输入来源：推荐股票表格  
   - 规则：先筛选推荐等级=⭐⭐⭐⭐⭐的股票；不足 8 只则按⭐⭐⭐⭐→⭐⭐⭐顺序补足；  
   - 排序：推荐等级降序 → 同等级按表格原始顺序；  
   - 输出限制：最多 8 只；若无评级则输出“暂无”。  

2) 热门板块  
   - 输入来源：表格“板块”列 + 行情要点/摘要  
   - 规则：板块字段按“/”“-”“>”拆分后计数；与摘要关键词合并计数；  
   - 排序：频次降序；  
   - 输出限制：最多 5 个；为空则输出“暂无明确热门板块”。  

3) 关键催化剂  
   - 输入来源：行情要点/摘要 + 推荐理由  
   - 触发词：会议/发布/招标/政策/财报/访华/送审/量产/订单/涨价/降息/加息/IPO 等；  
   - 规则：抽取包含触发词的短语，去重后按出现先后排序；  
   - 输出限制：最多 4 条；为空则输出“暂无明确催化剂”。  

### Step 6: 导出 PNG 长图（必选）

```bash
# 将 Markdown 结果导出为 PNG 长图
./scripts/export_png.sh <markdown_path> [output_png_path]
```

**依赖说明（需手动安装）**：

```bash
python3 -m pip install markdown playwright
python3 -m playwright install chromium
```

## 使用示例

```txt
请分析 /path/to/report.pdf 中的股票

分析这份投研报告，剔除港股，按推荐等级排序

帮我提取这个PDF里推荐的股票，只要A股

# 导出 PNG 长图
./scripts/export_png.sh /path/to/report.md /path/to/report.png
```
